{% extends "_template_page.html" %}

{% block page_title %}Modis Lock{% endblock %}

{% block page_css %}
    {% assets 'tables_css' %}
        <link href="{{ ASSET_URL }}" rel="stylesheet">
    {% endassets %}
{% endblock %}

{% block page_heading %}
    <h2><i class="fa fa-fw fa-dashboard"></i> Dashboard</h2>
{% endblock %}

{% block page_name %}
    Dashboard
{% endblock %}

{% block page_content %}
        <div class="row">
            {# Heartbeat and Health #}
            <div class="col-lg-3">
                <div class="widget style1 {% if health %}navy-bg{% else %}yellow-bg{% endif %}">
                    <div class="row">
                        <div class="col-xs-4">
                            <i class="fa fa-heartbeat fa-5x"></i>
                        </div>
                        <div class="col-xs-8 text-right">
                            <span> System Status </span>
                            <h2 class="font-bold">{% if health %}Good{% else %}Degraded{% endif %}</h2>
                        </div>
                    </div>
                </div>
            </div>
            {# System Information #}
            <div class="col-lg-3">
                <div class="widget style1 blue-bg">
                    <div class="row">
                        <div class="col-xs-4">
                            <i class="fa fa-info fa-5x"></i>
                        </div>
                        <div class="col-xs-8 text-right">
                            <span> Error Messages </span>
                            <h2 class="font-bold">{{ errors }}</h2>
                        </div>
                    </div>
                </div>
            </div>
            {# Entries Today #}
            <div class="col-lg-3">
                <div class="widget style1 navy-bg">
                    <div class="row">
                        <div class="col-xs-4">
                            <i class="fa fa-unlock fa-5x"></i>
                        </div>
                        <div class="col-xs-8 text-right">
                            <span> Validations Today </span>
                            <h2 class="font-bold">{{ valid_count }}</h2>
                        </div>
                    </div>
                </div>
            </div>
            {# Entries Denied #}
            <div class="col-lg-3">
                <div class="widget style1 red-bg">
                    <div class="row">
                        <div class="col-xs-4">
                            <i class="fa fa-exclamation-triangle fa-5x"></i>
                        </div>
                        <div class="col-xs-8 text-right">
                            <span> Denied Today </span>
                            <h2 class="font-bold">{{ denied_count }}</h2>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            {# Recent Events #}
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Recent Activity</h5>
                    </div>
                    <div class="ibox-context">
                        <table id="event_table" class="table table-striped table-bordered dataTables" cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Event Type</th>
                                    <th>Event Time</th>
                                    <th>Event Location</th>
                                    <th>Event Direction</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
{% endblock %}

{% block page_js %}
    {{ super() }}
    {% assets 'tables_js' %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}
    <script type="text/javascript">
        $(document).ready(function() {
           $('#event_table').DataTable({
{#               dom: '<"html5buttons"B>lTfgitp', #}
               dom: 'p',
{#               pageLength: 10,#}
               lengthChange: true,
               responsive: true,
               order: [[ 2, "desc"]],
               ajax: {
                   url: "/events",
                   method: 'POST',
                   data: {
                       action: 'request'
                   }
               },
               columnDefs: [
                   {
                       targets: [ 2 ],
                       {# 2017-01-09T12:29:12+00:00 #}
                       render: function( data, type, row ) {
                           return moment(data).format('YYYY-MM-DD HH:mm:ss');
                       }
                   }
               ],
               columns: [
                   {
                       data: null,
                       render: function(data, type, row){
                           return data.first_name + ' ' + data.last_name;
                       }
                   },
                   {data: 'event_type'},
                   {data: 'event_time'},
                   {data: 'location_name'},
                   {data: 'location_direction'}
                ]
           });
        });
    </script>
{% endblock %}

