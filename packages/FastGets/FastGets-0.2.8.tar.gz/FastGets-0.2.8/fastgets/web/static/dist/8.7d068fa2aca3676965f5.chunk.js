webpackJsonp([8],{247:function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e(839),s=e.n(n),i=e(840),o=e.n(i),a=e(1),c=!1,l=null,u=null,p=null,d=a(s.a,o.a,c,l,u,p);r.default=d.exports},839:function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default={data:function(){var t=this;return{showModal:!1,currentScript:null,trigger:"",columns:[{title:"#",type:"index",width:50,align:"center"},{title:"名称",key:"name",render:function(r,e){return e.row.process?r("div",{},[r("span",e.row.name),r("Tag",{props:{size:"small",color:"green",type:"border"},style:{float:"right"}},"正在运行")]):r("div",{},[r("span",e.row.name),r("Button",{props:{size:"small"},style:{float:"right"},on:{click:function(){t.runScript(e.row.name)}}},"启动")])}},{title:"定时任务配置",key:"trigger",render:function(r,e){return e.row.job?r("div",{},[r("span",e.row.job.trigger),r("Button",{props:{type:"error",size:"small"},style:{float:"right"},on:{click:function(){t.deleteJob(e.row.job.id)}}},"取消")]):r("span",{},"-")}},{title:"下次运行时间",key:"next",render:function(t,r){return r.row.job?t("span",r.row.job.next_run_at):t("span","-")}},{title:"操作",key:"action",render:function(r,e){return r("div",[r("Button",{props:{size:"small"},style:{marginRight:"5px"},on:{click:function(){t.showModal=!0,t.currentScript=e.row,t.trigger=t.currentScript.job?t.currentScript.job.trigger:null}}},"配置")])}}],scripts:[],cron_scripts:[],running_scripts:[]}},methods:{setTrigger:function(t){this.trigger=t},runScript:function(t){var r=this;this.$axios.get("/process/add",{params:{name:t,type:"script"}}).then(function(t){0===t.data.error_code?r.fetchScripts():alert(t.data.error_msg)})},addJob:function(){var t=this;this.$axios.get("/job/add",{params:{name:this.currentScript.name,trigger:this.trigger,type:"script"}}).then(function(r){0===r.data.error_code?t.fetchScripts():alert(r.data.error_msg)})},deleteJob:function(t){var r=this;this.$axios.get("/job/delete",{params:{id:t,type:"script"}}).then(function(t){0===t.data.error_code?r.fetchScripts():alert(t.data.error_msg)})},fetchScripts:function(){var t=this;this.$axios.get("/script/list").then(function(r){t.scripts=r.data.scripts,t.cron_scripts=[],t.running_scripts=[],t.scripts.forEach(function(r){r.job&&t.cron_scripts.push(r),r.process&&t.running_scripts.push(r)})})}},created:function(){this.fetchScripts()}}},840:function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("Row",{staticClass:"margin-top-10"},[e("Modal",{attrs:{title:"配置定时任务"},on:{"on-ok":t.addJob},model:{value:t.showModal,callback:function(r){t.showModal=r},expression:"showModal"}},[e("p",[e("Input",{model:{value:t.trigger,callback:function(r){t.trigger=r},expression:"trigger"}})],1),t._v(" "),e("br"),t._v(" "),e("p",[e("Button",{attrs:{size:"small",type:"ghost"},on:{click:function(){return t.setTrigger("0 3 1 * *")}}},[t._v("monthly")]),t._v(" "),e("Button",{attrs:{size:"small",type:"ghost"},on:{click:function(){return t.setTrigger("0 3 * * WED")}}},[t._v("weekly")]),t._v(" "),e("Button",{attrs:{size:"small",type:"ghost"},on:{click:function(){return t.setTrigger("0 3 * * *")}}},[t._v("daily")]),t._v(" "),e("Button",{attrs:{size:"small",type:"ghost"},on:{click:function(){return t.setTrigger("0 * * * *")}}},[t._v("hourly")])],1)]),t._v(" "),e("Card",[e("Row",[e("Col",{attrs:{span:"24"}},[e("Tabs",{attrs:{animated:!1}},[e("TabPane",{attrs:{label:"全部模板"}},[e("Table",{attrs:{stripe:"",border:"",columns:t.columns,data:t.scripts}})],1),t._v(" "),e("TabPane",{attrs:{label:"已配置"}},[e("Table",{attrs:{stripe:"",border:"",columns:t.columns,data:t.cron_scripts}})],1),t._v(" "),e("TabPane",{attrs:{label:"正在运行"}},[e("Table",{attrs:{stripe:"",border:"",columns:t.columns,data:t.running_scripts}})],1),t._v(" "),e("Button",{attrs:{slot:"extra",type:"ghost",size:"small"},on:{click:t.fetchScripts},slot:"extra"},[t._v("刷新")])],1)],1)],1)],1)],1)},s=[],i={render:n,staticRenderFns:s};r.default=i}});